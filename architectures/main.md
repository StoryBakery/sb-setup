# 개요

setup_configs 템플릿 설계와 매직패턴 규칙을 정의합니다.
Luau 기반 프로젝트와 비-Luau 프로젝트에서 동일한 방식으로 템플릿을 조합하는 것이 목적입니다.
본 문서는 템플릿 구조, 상속 순서, 매직패턴, TOML 구성의 최소 기준을 다룹니다.

## 템플릿-구조

- 템플릿 폴더 이름은 options 대신 templates로 통일합니다.
- 템플릿 루트는 `pkgs/setup_configs/src/templates/` 입니다.
- 사용자 커스텀 템플릿은 프로젝트 루트의 `setup_configs/templates/`에 추가할 수 있어야 합니다.
- 템플릿 탐색은 프로젝트 루트를 먼저 확인하고 없으면 패키지 템플릿을 사용합니다.
- 각 템플릿 폴더는 `template.toml`을 포함해야 합니다.
- 공통 베이스 템플릿 이름은 `base`로 고정합니다.
- `AGENTS.md`는 `base` 템플릿이 소유하고 다른 템플릿은 상속으로 확장합니다.

## 초기-템플릿

- `base` 템플릿을 공통 베이스로 둡니다.
- `non-luau` 템플릿은 비-Luau 프로젝트 구성을 제공합니다.
- `roblox-place` 템플릿은 Roblox place 구성을 제공합니다.

## 상속-규칙

- 템플릿 상속은 다중 상속을 허용합니다.
- `Extends` 목록은 왼쪽에서 오른쪽 순서대로 적용합니다.
- 최종 적용 순서는 `Extends`를 전개한 뒤 현재 템플릿을 마지막에 적용합니다.
- 같은 템플릿이 중복될 경우 최초 1회만 적용합니다.
- 공통 베이스인 `base`는 항상 가장 앞에 오도록 구성합니다.

## 매직-패턴

- 주석이 가능한 포맷에서는 주석으로 매직패턴을 기록합니다.
- 매직패턴은 BEGIN과 END 쌍으로 구성합니다.
- 표기는 실제 관습인 MANAGED BLOCK 형식을 따릅니다.
- 매직패턴 바깥 영역은 사용자 수정 영역으로 유지합니다.

```text
<comment> BEGIN STORY BAKERY MANAGED BLOCK: <block-id> [mode=append|replace|remove]
<comment> END STORY BAKERY MANAGED BLOCK: <block-id>
```

```text
# BEGIN STORY BAKERY MANAGED BLOCK: sb.agents.extra
# END STORY BAKERY MANAGED BLOCK: sb.agents.extra
```

```text
<!-- BEGIN STORY BAKERY MANAGED BLOCK: sb.agents.extra -->
<!-- END STORY BAKERY MANAGED BLOCK: sb.agents.extra -->
```

```text
-- BEGIN STORY BAKERY MANAGED BLOCK: sb.agents.extra
-- END STORY BAKERY MANAGED BLOCK: sb.agents.extra
```

## 블록-병합-규칙

- 기본 동작은 `mode=replace`로 간주합니다.
- `mode=append`는 기존 블록 뒤에 내용을 추가합니다.
- `mode=remove`는 해당 블록 전체를 제거합니다.
- 블록 내부만 관리하며 블록 밖은 유지합니다.
- 블록이 없으면 파일 끝에 새 블록을 추가합니다.

## 파일-전체-생성-표기

- 파일 전체가 생성 대상인 경우 최상단에 생성 표기를 둡니다.
- 생성 표기는 첫 번째 비주석, 비공백 라인보다 앞에 있어야 합니다.
- 표기는 관습에 맞춘 다음 형식을 사용합니다.

```text
<comment> Code generated by story-bakery setup_configs. DO NOT EDIT.
```

## TOML-구성

- 프로젝트 루트에 `setup_configs.toml`을 둡니다.
- `Templates`는 적용할 템플릿 목록이며 왼쪽부터 적용합니다.
- `base`는 항상 첫 항목으로 둡니다.

```toml
Templates = ["base", "non-luau", "roblox-place"]
```

- 커스텀 템플릿 주소가 필요하면 `[[Templates]]` 형식을 사용합니다.
- `Source`는 템플릿 루트 경로이며 상대 경로는 프로젝트 루트를 기준으로 해석합니다.

```toml
[[Templates]]
Name = "base"

[[Templates]]
Name = "custom"
Source = "setup_configs/templates/custom"
```

- 각 템플릿 폴더에 `template.toml`을 둡니다.
- `Name`은 폴더 이름과 동일한 식별자입니다.
- `Description`은 템플릿 설명입니다.
- `Extends`는 상속할 템플릿 목록입니다.

```toml
Name = "roblox-place"
Description = "Roblox place 템플릿입니다."
Extends = ["base", "non-luau"]
```

## 비주석-포맷

- 주석이 불가능한 포맷은 매직패턴을 사용하지 않습니다.
- 이 경우 파일 전체를 템플릿으로 교체하는 방식만 허용합니다.

## 문서-추가

- 템플릿 추가 방법과 규칙은 `pkgs/setup_configs/docs/`에 문서로 정리합니다.

